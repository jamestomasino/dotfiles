#!/bin/sh
if hash lpass && hash jq; then
  if [ -n "$1" ]; then
    repo="$1"
    desc="${2:-autogenerated}"
    user="$(lpass show --username Github)"
    pass="$(lpass show --pass Github)"
    if [ -n "$user" ]; then
      remote="$(curl -su "${user}:${pass}" "https://api.github.com/user/repos" -d "{\"name\":\"$repo\", \"description\":\"$desc\"}" | jq -r .full_name)"
      if [ -d .git ] || git rev-parse --git-dir > /dev/null 2> /dev/null; then
        reporemote="$(printf "git@github.com:%s.git" "${remote}")"
        if git remote | grep -q origin; then
          printf "%s repo created, but you are in a different one\\n" "$remote"
        else
          git remote add origin "$reporemote"
        fi
      else
        printf "%s repo created\\n" "$remote"
      fi
    else
      printf "username or password not found for Github.\\n"
    fi
  else
    printf "repo name required (and description optional).\\n"
  fi
else
  printf "this script requires lastpass-cli and jq to be installed.\\n"
fi
